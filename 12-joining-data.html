<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>12&nbsp; Relational data – BANA 4080: Data Mining</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./13-data-viz-pandas.html" rel="next">
<link href="./11_aggregating_data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-5d254f1e278c2921d96b26102a150bb1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-530b29c22fe67fc61ace1451aaa50055.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-5d254f1e278c2921d96b26102a150bb1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-45c1b2e5a2b0567ccfb99e4dfc03f650.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-54ba87e1857bbaa32a381632a2aab8bf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-45c1b2e5a2b0567ccfb99e4dfc03f650.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar docked quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-manipulating-data.html">Module 4</a></li><li class="breadcrumb-item"><a href="./12-joining-data.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Relational data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">BANA 4080: Data Mining</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/bradleyboehmke/uc-bana-4080" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./BANA-4080--Data-Mining.epub" title="Download ePub" class="quarto-navigation-tool px-1" aria-label="Download ePub"><i class="bi bi-journal"></i></a>
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro-data-mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-preparing-for-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Setting Up Your Python Environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-python-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Python Basics – Working with Data and Variables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Getting Started with Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-libraries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Packages, Libraries, and Modules</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-importing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Importing Data and Exploring Pandas DataFrames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Deeper Dive on DataFrames</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-subsetting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Subsetting Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-manipulating-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Manipulating Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_aggregating_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Summarizing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-joining-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Relational data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-data-viz-pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Intro to Data Visualization with Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-data-viz-matplotlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Fundamentals of Plotting with Matplotlib</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-data-viz-bokeh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Interactive Data Visualization with Bokeh</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-control-statements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Controlling Program Flow with Conditional Statements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-iteration-statements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Controlling Repetition with Iteration Statements</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Writing Your Own Functions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-intro-ml-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Introduction to Machine Learning and Artificial Intelligence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-before-we-build.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Before You Build: Key Considerations</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-correlation-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Correlation and Linear Regression Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-regression-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Evaluating Regression Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Introduction to Logistic Regression for Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-classification-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Evaluating Classification Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 10</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-decision-trees.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Decision Trees: Foundations and Interpretability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-random-forests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Random Forests: Ensemble Power and Robustness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-feature-importance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Understanding Feature Importance: Peeking Inside the Black Box</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">Module 11</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28-cross-validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Cross-validation: Reliable model evaluation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-anaconda-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Anaconda Installation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-vscode-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">VS Code Installation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link active" data-scroll-target="#prerequisites"><span class="header-section-number">12.1</span> Prerequisites</a></li>
  <li><a href="#understanding-keys" id="toc-understanding-keys" class="nav-link" data-scroll-target="#understanding-keys"><span class="header-section-number">12.2</span> 🔑 Understanding Keys</a></li>
  <li><a href="#mutating-joins" id="toc-mutating-joins" class="nav-link" data-scroll-target="#mutating-joins"><span class="header-section-number">12.3</span> Mutating Joins</a>
  <ul class="collapse">
  <li><a href="#types-of-joins" id="toc-types-of-joins" class="nav-link" data-scroll-target="#types-of-joins">Types of Joins</a></li>
  <li><a href="#inner-join" id="toc-inner-join" class="nav-link" data-scroll-target="#inner-join">Inner Join</a></li>
  <li><a href="#outer-joins" id="toc-outer-joins" class="nav-link" data-scroll-target="#outer-joins">Outer Joins</a></li>
  </ul></li>
  <li><a href="#working-with-differently-named-keys" id="toc-working-with-differently-named-keys" class="nav-link" data-scroll-target="#working-with-differently-named-keys"><span class="header-section-number">12.4</span> Working with Differently Named Keys</a></li>
  <li><a href="#a-larger-example-with-complete-journey-data" id="toc-a-larger-example-with-complete-journey-data" class="nav-link" data-scroll-target="#a-larger-example-with-complete-journey-data"><span class="header-section-number">12.5</span> A Larger Example with Complete Journey Data</a>
  <ul class="collapse">
  <li><a href="#knowledge-check" id="toc-knowledge-check" class="nav-link" data-scroll-target="#knowledge-check">Knowledge check</a></li>
  </ul></li>
  <li><a href="#merge-indicator" id="toc-merge-indicator" class="nav-link" data-scroll-target="#merge-indicator"><span class="header-section-number">12.6</span> Merge Indicator</a>
  <ul class="collapse">
  <li><a href="#knowledge-check-1" id="toc-knowledge-check-1" class="nav-link" data-scroll-target="#knowledge-check-1">🔍 Knowledge Check</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">12.7</span> Summary</a></li>
  <li><a href="#exercise-understanding-shopping-behavior" id="toc-exercise-understanding-shopping-behavior" class="nav-link" data-scroll-target="#exercise-understanding-shopping-behavior"><span class="header-section-number">12.8</span> Exercise: Understanding Shopping Behavior</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/bradleyboehmke/uc-bana-4080/edit/main/12-joining-data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bradleyboehmke/uc-bana-4080/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./10-manipulating-data.html">Module 4</a></li><li class="breadcrumb-item"><a href="./12-joining-data.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Relational data</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Relational data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In many data projects, we work with more than one table. A product’s description might be in one table, customer demographics in another, and transaction records in yet another. To make sense of these interconnected datasets, we need to combine them in ways that preserve the relationships between them.</p>
<p>This is the world of <strong>relational data</strong>—data stored in multiple related tables. Each table gives us a piece of the story, but we only get a full picture when we connect the pieces together.</p>
<p>To do that, we use <strong>joins</strong>, which allow us to merge tables using key variables they have in common. In this chapter, we’ll build up your understanding of joins in pandas and give you hands-on experience combining data from multiple sources.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>Try It: Exploring Relationships Between Tables
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Before we dive into code, let’s step into the mindset of a data wrangler.</p>
<p>We’ll work with two tables so go ahead and download them:</p>
<ul>
<li><a href="https://github.com/bradleyboehmke/uc-bana-4080/blob/main/data/transactions.csv">transactions</a>: item-level purchases made by households at a retail grocery store</li>
<li><a href="https://github.com/bradleyboehmke/uc-bana-4080/blob/main/data/demographics.csv">demographics</a>: attributes of each household, including income, age, and household size</li>
</ul>
<p>Open both of these tables in Python or export them to Excel/Google Sheets. As you explore them, consider:</p>
<ol type="1">
<li>What kinds of questions could you answer by combining these two tables?
<ul>
<li>For example: Do larger households purchase more per trip?</li>
<li>Do younger households spend more on snacks?</li>
<li>Is there a difference in average spending by income level?</li>
</ul></li>
<li>What variable(s) would you need to merge the two tables?</li>
<li>What type of relationship do you expect? Do you think each household has many transactions or do you think there will be only one transaction for each household?</li>
<li><strong>Challenge</strong>: Try performing the merge in Excel or Google Sheets. What challenges do you encounter?</li>
</ol>
</div>
</div>
</div>
<p>By the end of this lesson you’ll be able to:</p>
<ul>
<li>Use various mutating joins to combine variables from two tables.</li>
<li>Join two tables that have differing common key variable names.</li>
<li>Include an indicator variable while joining so you can filter the joined data for follow-on analysis.</li>
</ul>
<p>Before we dive into code, watch this short video for a practical overview of how to join DataFrames in pandas. It walks through key concepts like different types of joins and when to use them. After watching, you’ll be ready to roll up your sleeves and apply these techniques in the hands-on examples that follow.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/iYWKfUOtGaw" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>📓 Follow Along in Colab!
</div>
</div>
<div class="callout-body-container callout-body">
<p>As you read through this chapter, we encourage you to follow along using the <a href="https://github.com/bradleyboehmke/uc-bana-4080/blob/main/example-notebooks/11_relational_data.ipynb">companion notebook</a> in Google Colab (or other editor of choice). This interactive notebook lets you run code examples covered in the chapter—and experiment with your own ideas.</p>
<p>👉 Open the <a href="https://colab.research.google.com/github/bradleyboehmke/uc-bana-4080/blob/main/example-notebooks/11_relational_data.ipynb">Relational Data Notebook in Colab</a>.</p>
</div>
</div>
<section id="prerequisites" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">12.1</span> Prerequisites</h2>
<p>Before we dive into real-world data, let’s start by loading the <code>pandas</code> library. This will give us access to the join functions we’ll be using throughout the chapter.</p>
<div id="065f8b11" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To build your intuition around joins, we’ll begin with two very simple DataFrames, <code>x</code> and <code>y</code>. In these examples:</p>
<ul>
<li>The <strong>colored column</strong> represents the <strong>key</strong> variable used to match rows between tables.</li>
<li>The <strong>gray column</strong> represents the <strong>value</strong> column—this is the information that gets carried along in the merge.</li>
</ul>
<div id="fig-join-dfs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-join-dfs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/original-dfs-join-chapter.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Simple Example DFs</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-join-dfs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.1: Two simple DataFrames with a shared key column.
</figcaption>
</figure>
</div>
<p>Here’s how we’ll create them in code:</p>
<div id="ee633dba" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.DataFrame({<span class="st">'id'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="st">'val_x'</span>: [<span class="st">'x1'</span>, <span class="st">'x2'</span>, <span class="st">'x3'</span>]})</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> pd.DataFrame({<span class="st">'id'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>], <span class="st">'val_y'</span>: [<span class="st">'y1'</span>, <span class="st">'y2'</span>, <span class="st">'y4'</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>These examples will help you understand what joins do and how they behave before we move on to working with larger, more complex tables.</p>
<p>However, we will also build upon the simple examples by using various data sets from the <strong>completejourney_py</strong> library. This library provides access to data sets characterizing household level transactions over one year from a group of 2,469 households who are frequent shoppers at a grocery store.</p>
<p>There are eight built-in data sets available in this library. The data sets include:</p>
<ul>
<li><strong>transactions</strong>: item-level purchases made by households at a retail grocery store</li>
<li><strong>demographics</strong>: household demographic data (age, income, family size, etc.)</li>
<li><strong>products</strong>: product metadata (brand, description, etc.)</li>
<li><strong>campaigns</strong>: campaigns received by each household</li>
<li><strong>campaign_descriptions</strong>: campaign metadata (length of time active)</li>
<li><strong>coupons</strong>: coupon metadata (UPC code, campaign, etc.)</li>
<li><strong>coupon_redemptions</strong>: coupon redemptions (household, day, UPC code, campaign)</li>
</ul>
<p>This is a Python equivalent of the R package <a href="https://github.com/bradleyboehmke/completejourney">completejourney</a>. The R package has a full guide to get you acquainted with the various data set schemas, which you can read <a href="https://bradleyboehmke.github.io/completejourney/articles/completejourney.html">here</a>.</p>
<div id="3e33136b" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> completejourney_py <span class="im">import</span> get_data</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get_data() provides a dictionary of several DataFrames</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cj_data <span class="op">=</span> get_data()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>cj_data.keys()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/completejourney_py/get_data.py:2: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81.
  from pkg_resources import resource_filename</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>dict_keys(['campaign_descriptions', 'coupons', 'promotions', 'campaigns', 'demographics', 'transactions', 'coupon_redemptions', 'products'])</code></pre>
</div>
</div>
<div id="6335e97d" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can check out the transactions data with the following</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>cj_data[<span class="st">'transactions'</span>].head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">household_id</th>
<th data-quarto-table-cell-role="th">store_id</th>
<th data-quarto-table-cell-role="th">basket_id</th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">quantity</th>
<th data-quarto-table-cell-role="th">sales_value</th>
<th data-quarto-table-cell-role="th">retail_disc</th>
<th data-quarto-table-cell-role="th">coupon_disc</th>
<th data-quarto-table-cell-role="th">coupon_match_disc</th>
<th data-quarto-table-cell-role="th">week</th>
<th data-quarto-table-cell-role="th">transaction_timestamp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>900</td>
<td>330</td>
<td>31198570044</td>
<td>1095275</td>
<td>1</td>
<td>0.50</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 11:53:26</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>900</td>
<td>330</td>
<td>31198570047</td>
<td>9878513</td>
<td>1</td>
<td>0.99</td>
<td>0.10</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:10:28</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1228</td>
<td>406</td>
<td>31198655051</td>
<td>1041453</td>
<td>1</td>
<td>1.43</td>
<td>0.15</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:26:30</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>906</td>
<td>319</td>
<td>31198705046</td>
<td>1020156</td>
<td>1</td>
<td>1.50</td>
<td>0.29</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:30:27</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>906</td>
<td>319</td>
<td>31198705046</td>
<td>1053875</td>
<td>2</td>
<td>2.78</td>
<td>0.80</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:30:27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>TODO
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take some time to read about the completejourney data set schema <a href="https://bradleyboehmke.github.io/completejourney/articles/completejourney.html#dataset-details">here</a>.</p>
<ol type="1">
<li>What different data sets are available and what do they represent?</li>
<li>What are the common variables between each table?</li>
</ol>
</div>
</div>
</section>
<section id="understanding-keys" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="understanding-keys"><span class="header-section-number">12.2</span> 🔑 Understanding Keys</h2>
<p>To combine two tables, we need a way to tell pandas how rows in one table relate to rows in another. That’s where <strong>keys</strong> come in.</p>
<p>A <strong>key</strong> is one or more columns used to match rows between two tables. These columns typically contain identifiers that link observations—like customer IDs, product codes, or dates.</p>
<p>There are two main types of keys you’ll encounter:</p>
<ul>
<li>A <strong>primary key</strong> uniquely identifies each row within its own table.</li>
<li>A <strong>foreign key</strong> connects to a primary key in another table, creating a relationship between the two.</li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>For example:</p>
<ul>
<li>In the <code>transactions</code> table, <code>household_id</code> acts as a <strong>foreign key</strong>—it tells us which household made the purchase.</li>
<li>In the <code>demographics</code> table, <code>household_id</code> is a <strong>primary key</strong>—each household appears only once.</li>
</ul>
</div>
</div>
</div>
<p>Together, these keys form a <strong>relation</strong>. In most cases, the relationship is <strong>one-to-many</strong>: one household can have many transactions, but each transaction belongs to only one household. Occasionally, you’ll encounter <strong>one-to-one</strong> relationships, where each row in one table maps to exactly one row in another.</p>
<p>When data is cleaned appropriately the keys used to match two tables will be commonly named. For example, the variable that can link our <code>x</code> and <code>y</code> data sets is named <code>id</code>:</p>
<div id="d695ef8a" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>x.columns.intersection(y.columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>Index(['id'], dtype='object')</code></pre>
</div>
</div>
<p>We can easily see this by looking at the <code>x</code> and <code>y</code> data but when working with larger data sets this becomes more appropriate than just viewing the data. For example, we can easily identify the common columns in the <strong>completejourney_py</strong> <code>transactions</code> and <code>demographics</code> data:</p>
<div id="1deba383" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>transactions <span class="op">=</span> cj_data[<span class="st">'transactions'</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>demographics <span class="op">=</span> cj_data[<span class="st">'demographics'</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>transactions.columns.intersection(demographics.columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Index(['household_id'], dtype='object')</code></pre>
</div>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>A Note on Column Names
</div>
</div>
<div class="callout-body-container callout-body">
<p>While it’s common for keys to have the same name in both tables (like <code>id</code>, <code>household_id</code>, or <code>product_id</code>), that’s not always the case. For example, our household identifier could be named <code>household_id</code> in the transaction data but be <code>hshd_id</code> in the demographics table. Although the names differ, they represent the same information. When column names differ, you can still join the tables—you just need to tell pandas which columns to use, which we will discuss later.</p>
</div>
</div>
</section>
<section id="mutating-joins" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="mutating-joins"><span class="header-section-number">12.3</span> Mutating Joins</h2>
<p>When working with multiple DataFrames, we often want to combine information from different sources based on a shared key. A <strong>mutating join</strong> allows us to do exactly that—it matches rows across two tables based on a key and brings in additional columns from one table to the other.</p>
<p>In this section, you’ll learn how to use pandas to perform various types of joins that are essential for working with relational data.</p>
<section id="types-of-joins" class="level3">
<h3 class="anchored" data-anchor-id="types-of-joins">Types of Joins</h3>
<p>There are several types of joins, each serving a different purpose:</p>
<ul>
<li><strong>Inner join</strong>: Keeps only the rows with keys that match in both tables.</li>
<li><strong>Left join</strong>: Keeps all rows from the left table and brings in matching rows from the right.</li>
<li><strong>Right join</strong>: Keeps all rows from the right table and brings in matching rows from the left.</li>
<li><strong>Full outer join</strong>: Keeps all rows from both tables.</li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>In pandas, you can join DataFrames using either <code>.join()</code> or <code>.merge()</code>. While <code>.join()</code> is designed for joining on indexes, <code>.merge()</code> is more flexible and allows joining on one or more columns. We’ll use <code>.merge()</code> throughout this chapter.</p>
</div>
</div>
</div>
</section>
<section id="inner-join" class="level3">
<h3 class="anchored" data-anchor-id="inner-join">Inner Join</h3>
<p>An <strong>inner join</strong> returns only the rows where the key exists in both DataFrames. This is the most restrictive type of join.</p>
<div id="fig-inner-join" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-inner-join-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/join-inner.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Inner join</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-inner-join-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.2: Inner join (<a href="https://r4ds.had.co.nz/relational-data.html">source</a>).
</figcaption>
</figure>
</div>
<div id="f00c9ab4" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x.merge(y, on<span class="op">=</span><span class="st">"id"</span>, how<span class="op">=</span><span class="st">"inner"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">val_x</th>
<th data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>x1</td>
<td>y1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>x2</td>
<td>y2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Only rows with matching values in both <code>x</code> and <code>y</code> are retained. In our example, only <code>id</code> values 1 and 2 appear in both tables.</p>
</div>
</div>
</div>
</section>
<section id="outer-joins" class="level3">
<h3 class="anchored" data-anchor-id="outer-joins">Outer Joins</h3>
<p>An inner join keeps observations that appear in both tables. However, we often want to retain <strong><em>all</em></strong> observations in at least one of the tables. Consequently, we can apply various <strong>outer joins</strong> to retain observations that appear in at least one of the tables. There are three main types of outer joins:</p>
<ul>
<li>A left join keeps all observations in <code>x</code>.</li>
<li>A right join keeps all observations in <code>y</code>.</li>
<li>A full join keeps all observations in <code>x</code> and <code>y</code>.</li>
</ul>
<p>These joins work by adding <code>NaN</code> in rows where non-matching information exists:</p>
<div id="fig-outer-join" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-outer-join-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/join-outer.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Examples of outer joins</figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-outer-join-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12.3: Difference in left join, right join, and outer join procedures (<a href="https://r4ds.had.co.nz/relational-data.html">source</a>).
</figcaption>
</figure>
</div>
<section id="left-join" class="level4">
<h4 class="anchored" data-anchor-id="left-join">Left Join</h4>
<p>A <strong>left join</strong> keeps all rows from the left DataFrame (<code>x</code>) and adds matching rows from the right DataFrame (<code>y</code>). If no match is found, the result will contain <code>NaN</code> for the missing values.</p>
<div id="4e2efbea" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x.merge(y, on<span class="op">=</span><span class="st">"id"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">val_x</th>
<th data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>x1</td>
<td>y1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>x2</td>
<td>y2</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>x3</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="right-join" class="level4">
<h4 class="anchored" data-anchor-id="right-join">Right Join</h4>
<p>A <strong>right join</strong> is similar to a left join, but it retains all rows from the right DataFrame (<code>y</code>).</p>
<div id="b243c6ea" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x.merge(y, on<span class="op">=</span><span class="st">"id"</span>, how<span class="op">=</span><span class="st">"right"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">val_x</th>
<th data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>x1</td>
<td>y1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>x2</td>
<td>y2</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>4</td>
<td>NaN</td>
<td>y4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Should I use a right join, or a left join? To answer this, ask yourself <em>“which DataFrame should retain all of its rows?”</em> - and use this one as the baseline. A left join keeps all the rows in the first (leftside) DataFrame written in the command, whereas a right join keeps all the rows in the second (rightside) DataFrame.</p>
</div>
</div>
</div>
</section>
<section id="full-outer-join" class="level4">
<h4 class="anchored" data-anchor-id="full-outer-join">Full Outer Join</h4>
<p>A <strong>full outer join</strong> retains all rows from both DataFrames. Where there are no matches, it fills in <code>NaN</code> for missing values.</p>
<div id="161c74c4" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x.merge(y, on<span class="op">=</span><span class="st">"id"</span>, how<span class="op">=</span><span class="st">"outer"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">val_x</th>
<th data-quarto-table-cell-role="th">val_y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>x1</td>
<td>y1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>x2</td>
<td>y2</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>x3</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>NaN</td>
<td>y4</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>This is the most inclusive join. It’s useful when you don’t want to lose any data.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="working-with-differently-named-keys" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="working-with-differently-named-keys"><span class="header-section-number">12.4</span> Working with Differently Named Keys</h2>
<p>So far, the keys we’ve used to join two DataFrames have had the same name. This was encoded by using <code>on='id'</code>. However, having keys with the same name is not a requirement. But what happens we our common key variable is named differently in each DataFrame?</p>
<p>For example:</p>
<div id="1804d616" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> pd.DataFrame({<span class="st">'id_a'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="st">'val_a'</span>: [<span class="st">'x1'</span>, <span class="st">'x2'</span>, <span class="st">'x3'</span>]})</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> pd.DataFrame({<span class="st">'id_b'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>], <span class="st">'val_b'</span>: [<span class="st">'y1'</span>, <span class="st">'y2'</span>, <span class="st">'y4'</span>]})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In this case, since our common key variable has different names in each table (<code>id_a</code> in <code>a</code> and <code>id_b</code> in <code>b</code>), our inner join function doesn’t know how to join these two DataFrames and an error results.</p>
<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Example merge error
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="00ca6f60" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>a.merge(b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">MergeError</span>                                Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[12], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> <span class="ansi-yellow-bg">a</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">merge</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">b</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/frame.py:10839</span>, in <span class="ansi-cyan-fg">DataFrame.merge</span><span class="ansi-blue-fg">(self, right, how, on, left_on, right_on, left_index, right_index, sort, suffixes, copy, indicator, validate)</span>
<span class="ansi-green-fg ansi-bold">  10820</span> <span style="color:rgb(175,0,255)">@Substitution</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">  10821</span> <span style="color:rgb(175,0,255)">@Appender</span>(_merge_doc, indents<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">2</span>)
<span class="ansi-green-fg ansi-bold">  10822</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span><span style="color:rgb(188,188,188)"> </span><span style="color:rgb(0,0,255)">merge</span>(
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">  10835</span>     validate: MergeValidate <span style="color:rgb(98,98,98)">|</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span> <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>,
<span class="ansi-green-fg ansi-bold">  10836</span> ) <span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">&gt;</span> DataFrame:
<span class="ansi-green-fg ansi-bold">  10837</span>     <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,0,255)">pandas</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">core</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">reshape</span><span style="font-weight:bold;color:rgb(0,0,255)">.</span><span style="font-weight:bold;color:rgb(0,0,255)">merge</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">import</span> merge
<span class="ansi-green-fg">&gt; 10839</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">merge</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">  10840</span> <span class="ansi-yellow-bg">        </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10841</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">right</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10842</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">how</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">how</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10843</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">on</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">on</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10844</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">left_on</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">left_on</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10845</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">right_on</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">right_on</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10846</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">left_index</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">left_index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10847</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">right_index</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">right_index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10848</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">sort</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sort</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10849</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">suffixes</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">suffixes</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10850</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">copy</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">copy</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10851</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">indicator</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">indicator</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10852</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">validate</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">validate</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">  10853</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/reshape/merge.py:170</span>, in <span class="ansi-cyan-fg">merge</span><span class="ansi-blue-fg">(left, right, how, on, left_on, right_on, left_index, right_index, sort, suffixes, copy, indicator, validate)</span>
<span class="ansi-green-fg ansi-bold">    155</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> _cross_merge(
<span class="ansi-green-fg ansi-bold">    156</span>         left_df,
<span class="ansi-green-fg ansi-bold">    157</span>         right_df,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    167</span>         copy<span style="color:rgb(98,98,98)">=</span>copy,
<span class="ansi-green-fg ansi-bold">    168</span>     )
<span class="ansi-green-fg ansi-bold">    169</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg">--&gt; 170</span>     op <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_MergeOperation</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">    171</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">left_df</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    172</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">right_df</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    173</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">how</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">how</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    174</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">on</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">on</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    175</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">left_on</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">left_on</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    176</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">right_on</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">right_on</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    177</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">left_index</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">left_index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    178</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">right_index</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">right_index</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    179</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">sort</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">sort</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    180</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">suffixes</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">suffixes</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    181</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">indicator</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">indicator</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    182</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">validate</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">validate</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    183</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    184</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> op<span style="color:rgb(98,98,98)">.</span>get_result(copy<span style="color:rgb(98,98,98)">=</span>copy)

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/reshape/merge.py:786</span>, in <span class="ansi-cyan-fg">_MergeOperation.__init__</span><span class="ansi-blue-fg">(self, left, right, how, on, left_on, right_on, left_index, right_index, sort, suffixes, indicator, validate)</span>
<span class="ansi-green-fg ansi-bold">    779</span>     msg <span style="color:rgb(98,98,98)">=</span> (
<span class="ansi-green-fg ansi-bold">    780</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Not allowed to merge between different levels. </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    781</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">(</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>_left<span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> levels on the left, </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    782</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>_right<span style="color:rgb(98,98,98)">.</span>columns<span style="color:rgb(98,98,98)">.</span>nlevels<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)"> on the right)</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    783</span>     )
<span class="ansi-green-fg ansi-bold">    784</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MergeError(msg)
<span class="ansi-green-fg">--&gt; 786</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>left_on, <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>right_on <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_validate_left_right_on</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">left_on</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">right_on</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    788</span> (
<span class="ansi-green-fg ansi-bold">    789</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>left_join_keys,
<span class="ansi-green-fg ansi-bold">    790</span>     <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>right_join_keys,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    793</span>     right_drop,
<span class="ansi-green-fg ansi-bold">    794</span> ) <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>_get_merge_keys()
<span class="ansi-green-fg ansi-bold">    796</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> left_drop:

File <span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pandas/core/reshape/merge.py:1572</span>, in <span class="ansi-cyan-fg">_MergeOperation._validate_left_right_on</span><span class="ansi-blue-fg">(self, left_on, right_on)</span>
<span class="ansi-green-fg ansi-bold">   1570</span> common_cols <span style="color:rgb(98,98,98)">=</span> left_cols<span style="color:rgb(98,98,98)">.</span>intersection(right_cols)
<span class="ansi-green-fg ansi-bold">   1571</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">len</span>(common_cols) <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">0</span>:
<span class="ansi-green-fg">-&gt; 1572</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MergeError(
<span class="ansi-green-fg ansi-bold">   1573</span>         <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">No common columns to perform merge on. </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1574</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Merge options: left_on=</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>left_on<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">, </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1575</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">right_on=</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span>right_on<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">, </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1576</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">left_index=</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>left_index<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">, </span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1577</span>         <span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">right_index=</span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">self</span><span style="color:rgb(98,98,98)">.</span>right_index<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">   1578</span>     )
<span class="ansi-green-fg ansi-bold">   1579</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> (
<span class="ansi-green-fg ansi-bold">   1580</span>     <span style="font-weight:bold;color:rgb(175,0,255)">not</span> left_cols<span style="color:rgb(98,98,98)">.</span>join(common_cols, how<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">inner</span><span style="color:rgb(175,0,0)">"</span>)<span style="color:rgb(98,98,98)">.</span>is_unique
<span class="ansi-green-fg ansi-bold">   1581</span>     <span style="font-weight:bold;color:rgb(175,0,255)">or</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> right_cols<span style="color:rgb(98,98,98)">.</span>join(common_cols, how<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">inner</span><span style="color:rgb(175,0,0)">"</span>)<span style="color:rgb(98,98,98)">.</span>is_unique
<span class="ansi-green-fg ansi-bold">   1582</span> ):
<span class="ansi-green-fg ansi-bold">   1583</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> MergeError(<span style="color:rgb(175,0,0)">f</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Data columns not unique: </span><span style="font-weight:bold;color:rgb(175,95,135)">{</span><span style="color:rgb(0,135,0)">repr</span>(common_cols)<span style="font-weight:bold;color:rgb(175,95,135)">}</span><span style="color:rgb(175,0,0)">"</span>)

<span class="ansi-red-fg">MergeError</span>: No common columns to perform merge on. Merge options: left_on=None, right_on=None, left_index=False, right_index=False</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<p>When this happens, we can explicitly tell our join function to use unique key names in each DataFrame as a common key with the <code>left_on</code> and <code>right_on</code> arguments:</p>
<div id="d3628869" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>a.merge(b, left_on<span class="op">=</span><span class="st">"id_a"</span>, right_on<span class="op">=</span><span class="st">"id_b"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_a</th>
<th data-quarto-table-cell-role="th">val_a</th>
<th data-quarto-table-cell-role="th">id_b</th>
<th data-quarto-table-cell-role="th">val_b</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>x1</td>
<td>1</td>
<td>y1</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>x2</td>
<td>2</td>
<td>y2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="a-larger-example-with-complete-journey-data" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="a-larger-example-with-complete-journey-data"><span class="header-section-number">12.5</span> A Larger Example with Complete Journey Data</h2>
<p>Let’s apply what we’ve learned to real data from the <code>completejourney_py</code> package.</p>
<p>Suppose we want to add product details to each transaction. That means we’ll join the <code>transactions</code> and <code>products</code> DataFrames. Because we want to retain all transaction records, even if product details are missing, we’ll use a <strong>left join</strong>.</p>
<p>First, check the column names:</p>
<div id="96bf56c8" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cj_data <span class="op">=</span> get_data()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>transactions <span class="op">=</span> cj_data[<span class="st">"transactions"</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>products <span class="op">=</span> cj_data[<span class="st">"products"</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'transactions columns: </span><span class="sc">{</span>transactions<span class="sc">.</span>columns<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'products columns: </span><span class="sc">{</span>products<span class="sc">.</span>columns<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>transactions columns: Index(['household_id', 'store_id', 'basket_id', 'product_id', 'quantity',
       'sales_value', 'retail_disc', 'coupon_disc', 'coupon_match_disc',
       'week', 'transaction_timestamp'],
      dtype='object')
products columns: Index(['product_id', 'manufacturer_id', 'department', 'brand',
       'product_category', 'product_type', 'package_size'],
      dtype='object')</code></pre>
</div>
</div>
<p>And we can find if a common column name exists:</p>
<div id="c0b6d443" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>transactions.columns.intersection(products.columns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>Index(['product_id'], dtype='object')</code></pre>
</div>
</div>
<p>We see that both DataFrames share the <code>product_id</code> column. This aligns to the <a href="https://bradleyboehmke.github.io/completejourney/articles/completejourney.html#dataset-details">data dictionary</a> so we can trust this is the accurate common key. We can now perform a left join using<code>product_id</code> as the common key.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Joins add new variables to the far right of the resulting DataFrame. If you’re working in a wide table, you may need to scroll to see the added columns.</p>
</div>
</div>
</div>
<div id="953ce1f9" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>transactions.merge(products, on<span class="op">=</span><span class="st">"product_id"</span>, how<span class="op">=</span><span class="st">"left"</span>).head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">household_id</th>
<th data-quarto-table-cell-role="th">store_id</th>
<th data-quarto-table-cell-role="th">basket_id</th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">quantity</th>
<th data-quarto-table-cell-role="th">sales_value</th>
<th data-quarto-table-cell-role="th">retail_disc</th>
<th data-quarto-table-cell-role="th">coupon_disc</th>
<th data-quarto-table-cell-role="th">coupon_match_disc</th>
<th data-quarto-table-cell-role="th">week</th>
<th data-quarto-table-cell-role="th">transaction_timestamp</th>
<th data-quarto-table-cell-role="th">manufacturer_id</th>
<th data-quarto-table-cell-role="th">department</th>
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">product_category</th>
<th data-quarto-table-cell-role="th">product_type</th>
<th data-quarto-table-cell-role="th">package_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>900</td>
<td>330</td>
<td>31198570044</td>
<td>1095275</td>
<td>1</td>
<td>0.50</td>
<td>0.00</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 11:53:26</td>
<td>2.0</td>
<td>PASTRY</td>
<td>National</td>
<td>ROLLS</td>
<td>ROLLS: BAGELS</td>
<td>4 OZ</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>900</td>
<td>330</td>
<td>31198570047</td>
<td>9878513</td>
<td>1</td>
<td>0.99</td>
<td>0.10</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:10:28</td>
<td>69.0</td>
<td>GROCERY</td>
<td>Private</td>
<td>FACIAL TISS/DNR NAPKIN</td>
<td>FACIAL TISSUE &amp; PAPER HANDKE</td>
<td>85 CT</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1228</td>
<td>406</td>
<td>31198655051</td>
<td>1041453</td>
<td>1</td>
<td>1.43</td>
<td>0.15</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:26:30</td>
<td>69.0</td>
<td>GROCERY</td>
<td>Private</td>
<td>BAG SNACKS</td>
<td>POTATO CHIPS</td>
<td>11.5 OZ</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>906</td>
<td>319</td>
<td>31198705046</td>
<td>1020156</td>
<td>1</td>
<td>1.50</td>
<td>0.29</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:30:27</td>
<td>2142.0</td>
<td>GROCERY</td>
<td>National</td>
<td>REFRGRATD DOUGH PRODUCTS</td>
<td>REFRIGERATED BAGELS</td>
<td>17.1 OZ</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>906</td>
<td>319</td>
<td>31198705046</td>
<td>1053875</td>
<td>2</td>
<td>2.78</td>
<td>0.80</td>
<td>0.0</td>
<td>0.0</td>
<td>1</td>
<td>2017-01-01 12:30:27</td>
<td>2326.0</td>
<td>GROCERY</td>
<td>National</td>
<td>SEAFOOD - SHELF STABLE</td>
<td>TUNA</td>
<td>5.0 OZ</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This has now added product information to each transaction. Consequently, if we wanted to get the total sales across the meat <code>department</code> but summarized at the <code>product_category</code> level so that we can identify which products generate the greatest sales we could follow this joining procedure with additional skills we learned in previous lessons:</p>
<div id="7507154b" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    transactions</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    .merge(products, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span><span class="st">'product_id'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    .query(<span class="st">"department == 'MEAT'"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'product_category'</span>, as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    .agg({<span class="st">'sales_value'</span>: <span class="st">'sum'</span>})</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    .sort_values(by<span class="op">=</span><span class="st">'sales_value'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">product_category</th>
<th data-quarto-table-cell-role="th">sales_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">1</th>
<td>BEEF</td>
<td>176614.54</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">2</th>
<td>CHICKEN</td>
<td>52703.51</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">10</th>
<td>PORK</td>
<td>50809.31</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">12</th>
<td>SMOKED MEATS</td>
<td>15324.22</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">13</th>
<td>TURKEY</td>
<td>11128.95</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">4</th>
<td>EXOTIC GAME/FOWL</td>
<td>860.42</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5</th>
<td>LAMB</td>
<td>829.27</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">14</th>
<td>VEAL</td>
<td>167.13</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>MEAT SUPPLIES</td>
<td>57.03</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>MEAT - MISC</td>
<td>39.66</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">11</th>
<td>RW FRESH PROCESSED MEAT</td>
<td>30.84</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>COUPON</td>
<td>7.00</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>LUNCHMEAT</td>
<td>2.20</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>MISCELLANEOUS</td>
<td>0.95</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>BACON</td>
<td>0.30</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="knowledge-check" class="level3">
<h3 class="anchored" data-anchor-id="knowledge-check">Knowledge check</h3>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>Try it yourself:
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Join the <code>transactions</code> and <code>demographics</code> data so that you have household demographics for each transaction. Now compute the total sales by <code>age</code> category to identify which age group generates the most sales.</li>
<li>Use successive joins to join <code>transactions</code> with <code>coupons</code> and then with <code>coupon_redemptions</code>. Use the proper join that will only retain those transactions that have coupon and coupon redemption data.</li>
</ol>
<p>Try the above yourself and then see my approach here:</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/oQTC9TS3r9I" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</section>
</section>
<section id="merge-indicator" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="merge-indicator"><span class="header-section-number">12.6</span> Merge Indicator</h2>
<p>You can use the <code>indicator</code> argument to add a special column called <code>_merge</code> that shows where each row in the joined table came from. The values in <code>_merge</code> will be:</p>
<ul>
<li><code>'left_only'</code> — the row came only from the left table</li>
<li><code>'right_only'</code> — the row came only from the right table</li>
<li><code>'both'</code> — the row had a match in both tables</li>
</ul>
<p>This is helpful when you’re trying to understand or debug the result of a join:</p>
<div id="ab8d2dd1" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x.merge(y, how<span class="op">=</span><span class="st">'outer'</span>, indicator<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">val_x</th>
<th data-quarto-table-cell-role="th">val_y</th>
<th data-quarto-table-cell-role="th">_merge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>x1</td>
<td>y1</td>
<td>both</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>x2</td>
<td>y2</td>
<td>both</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>x3</td>
<td>NaN</td>
<td>left_only</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>NaN</td>
<td>y4</td>
<td>right_only</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This feature is also useful when filtering rows based on whether they had a match. For example:</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span><strong>Scenario</strong>: Your manager asks,
</div>
</div>
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p><em>“Of all our transactions, how many are from households that we <strong>don’t</strong> have demographic information for?”</em></p>
</blockquote>
</div>
</div>
<p>You can answer this by performing an outer join between <code>transactions</code> and <code>demographics</code>, then filtering for rows with <code>_merge == 'left_only'</code>:</p>
<div id="67453512" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of transactions</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>transactions.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(1469307, 11)</code></pre>
</div>
</div>
<div id="8d7a18ab" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transactions without matching demographic info</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    transactions</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    .merge(demographics, how<span class="op">=</span><span class="st">'outer'</span>, indicator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    .query(<span class="st">"_merge == 'left_only'"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>).shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>(640457, 19)</code></pre>
</div>
</div>
<p>In this case, 640,457 transactions (about 43%) come from households without demographic information.</p>
<section id="knowledge-check-1" class="level3">
<h3 class="anchored" data-anchor-id="knowledge-check-1">🔍 Knowledge Check</h3>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>Try it yourself:
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Using the <code>products</code> and <code>transactions</code> tables, how many products have been sold?<br>
How many products are in inventory but have <strong>not</strong> appeared in any transaction?</li>
<li>Using <code>demographics</code> and <code>transactions</code>, which income group buys the highest <strong>total quantity</strong> of goods?</li>
</ol>
<p>Try the above yourself and then see my approach here:</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/pyc9MeHN4AQ" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</section>
</section>
<section id="summary" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="summary"><span class="header-section-number">12.7</span> Summary</h2>
<p>In this chapter, you explored how to work with <strong>relational data</strong>—data that lives across multiple, related tables. You learned how to use <strong>joins</strong> in pandas to combine these tables using shared key variables, allowing you to answer more complex and meaningful questions.</p>
<p>You practiced:</p>
<ul>
<li>Identifying and working with <strong>keys</strong> (primary and foreign).</li>
<li>Performing <strong>mutating joins</strong> including <code>inner</code>, <code>left</code>, <code>right</code>, and <code>full outer</code> joins.</li>
<li>Handling <strong>differently named key columns</strong> using <code>left_on</code> and <code>right_on</code>.</li>
<li>Using the <strong>merge indicator</strong> to understand which rows matched or didn’t match between tables.</li>
<li>Applying these techniques to real retail transaction data using the <code>completejourney_py</code> package.</li>
</ul>
<p>Relational data techniques give you the power to piece together a fuller picture of what’s happening in your data. But once you’ve wrangled the data into shape, the next challenge is making your findings clear and compelling.</p>
<p>In the next chapter, we’ll shift gears and explore <strong>data visualization</strong>—learning how to communicate insights effectively using Python plotting libraries like <code>matplotlib</code> and <code>seaborn</code>.</p>
</section>
<section id="exercise-understanding-shopping-behavior" class="level2" data-number="12.8">
<h2 data-number="12.8" class="anchored" data-anchor-id="exercise-understanding-shopping-behavior"><span class="header-section-number">12.8</span> Exercise: Understanding Shopping Behavior</h2>
<p>Use the datasets provided by the <code>completejourney_py</code> package to complete the following exercises. These tasks will help you practice joining tables, filtering data, and computing summary statistics. If you’re unfamiliar with the structure of these datasets, take a few minutes to review the <a href="https://bradleyboehmke.github.io/completejourney/articles/completejourney.html">Complete Journey data dictionary</a> to understand how the tables relate to one another.</p>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>1. Total Sales by Age Group (With a Join)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Join the <code>transactions</code> and <code>demographics</code> tables. Then compute the <strong>total <code>sales_value</code></strong> by <code>age</code> group.</p>
<ul>
<li>Which age group generates the most total sales?</li>
<li>Bonus: How does this change if you only consider transactions over $5?</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>2. What Are Families Buying?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the <code>transactions</code>, <code>products</code>, and <code>demographics</code> tables:</p>
<ul>
<li>Focus only on households with <strong>3 or more members</strong> (use <code>household_size</code> from <code>demographics</code>).</li>
<li>Identify the <strong>top 5 most frequently purchased product categories</strong> among these households.</li>
<li>What percent of their purchases come from the <code>MEAT</code> department?</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>3. Coupon-Driven Purchases
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Join <code>transactions</code>, <code>coupon_redemptions</code>, and <code>coupons</code> together. Then:</p>
<ul>
<li>Find the <strong>total number of coupon redemptions</strong> by <code>campaign</code>.</li>
<li>Which campaign resulted in the <strong>highest total <code>sales_value</code></strong>?</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>4. High Spenders Without Demographics
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>From your existing prompt:</p>
<ul>
<li>Identify households with <strong>total sales ≥ $100</strong>.</li>
<li>Among them, how many <strong>do not appear</strong> in the <code>demographics</code> table?</li>
<li>What percent of all $100+ spenders are missing demographic info?</li>
</ul>
<p><strong>Tip</strong>: Use the <code>indicator=True</code> argument to help with this.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">None</span>5. Front Display Effectiveness
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Join <code>promotions</code> with <code>transactions</code> and <code>products</code>.</p>
<ul>
<li>Filter to products that were part of a <strong>front-of-store display</strong> (<code>display_location == 1</code>).</li>
<li>For those products, compute:
<ul>
<li>Total <code>sales_value</code></li>
<li>Total <code>quantity</code> sold</li>
<li>Top 3 departments (by sales)</li>
</ul></li>
</ul>
<p>How do these compare to products not on display?</p>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./11_aggregating_data.html" class="pagination-link" aria-label="Summarizing Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Summarizing Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./13-data-viz-pandas.html" class="pagination-link" aria-label="Intro to Data Visualization with Pandas">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Intro to Data Visualization with Pandas</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/bradleyboehmke/uc-bana-4080/edit/main/12-joining-data.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/bradleyboehmke/uc-bana-4080/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>